import{r as e,c as a,o as t,i as l,a as o,n,b as u,d as r,e as c,f as s,w as i,u as p,F as d,g as m,h as v}from"./vendor.baaec12a.js";m({setup(m){const v=e([]),f=e(1),N=e(10),g=e(""),w=e([]),h=e([]),b=a((()=>h.value.map((e=>({text:e,value:e}))))),y=e([]),P=e([]),U=a((()=>P.value.map((e=>({text:e,value:e}))))),x=e(null);async function A({companies:e,serverName:a,townName:t,updatedAt:l}){const o=[];for(const n of e)for(const e of n.products)o.push({updatedAt:l,serverName:a,townName:t,companyName:n.company_name,productName:e.name,productAmount:e.amount,productUnitPrice:e.unit_price});return o}t((async function(){const e=l.service(),{data:a}=await o.get("data/stats.json");let t=[];h.value=[],P.value=[];for(const l in a){h.value.push(l);const e=a[l];for(const a in e){-1===P.value.indexOf(a)&&P.value.push(a);if(0===e[a])continue;const{data:n}=await o.get(`data/${l}-${a}.json`),{companies:u,updated_at:r}=n;t=t.concat(await A({companies:u,serverName:l,townName:a,updatedAt:r}))}}v.value=t,w.value=h.value,y.value=P.value,console.log(w.value,y.value),n((()=>e.close()))}));const k=a((function(){console.log(w,w.value);const e=v.value.filter((e=>!(""!==g.value&&!e.productName.match(g.value))&&(-1!==w.value.indexOf(e.serverName)&&-1!==y.value.indexOf(e.townName))));return console.log(e),e.sort(((e,a)=>"ascending"===x.value?e.productUnitPrice-a.productUnitPrice:"descending"===x.value?a.productUnitPrice-e.productUnitPrice:0))})),C=a((function(){return k.value.slice((f.value-1)*N.value,f.value*N.value)}));function _(e,a,t,l){return(new Intl.NumberFormat).format(Number(t))}function j(e){console.log("onChangePage",e),f.value=e}function z({column:e,prop:a,order:t}){"productUnitPrice"===a&&(x.value=t)}function F(e){console.log(e),e.serverName&&(w.value=e.serverName),e.townName&&(y.value=e.townName)}function O(){return!0}return(e,a)=>{const t=u("el-input"),l=u("el-table-column"),o=u("el-table"),n=u("el-pagination");return r(),c(d,null,[s(t,{modelValue:g.value,"onUpdate:modelValue":a[1]||(a[1]=e=>g.value=e),size:"mini",placeholder:"商品關鍵字"},null,8,["modelValue"]),s(o,{"row-key":"date",data:p(C),style:{width:"100%"},onSortChange:z,onFilterChange:F},{default:i((()=>[s(l,{prop:"updatedAt",label:"更新日期",width:"180","column-key":"date"}),s(l,{prop:"serverName",label:"伺服器",width:"180","column-key":"serverName",filters:p(b),"filter-method":O,"filtered-value":w.value},null,8,["filters","filtered-value"]),s(l,{prop:"townName",label:"港口","column-key":"townName",filters:p(U),"filter-method":O,"filtered-value":y.value},null,8,["filters","filtered-value"]),s(l,{prop:"companyName",label:"商會"}),s(l,{prop:"productName",label:"商品"}),s(l,{prop:"productAmount",label:"數量"}),s(l,{prop:"productUnitPrice",sortable:"",label:"價格",formatter:_})])),_:1},8,["data"]),s(n,{background:"",layout:"prev, pager, next",total:p(k).length,"page-size":N.value.value,onCurrentChange:j},null,8,["total","page-size"])],64)}}}).use(v).mount("#app");
